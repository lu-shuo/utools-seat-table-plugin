# 学生排座助手 - 功能更新说明

## 📋 本次更新内容

### ✨ 新增功能

#### 1. 班级信息编辑组件化
- 将编辑表单拆分为独立的 `EditClassDialog` 组件
- 支持编辑班级名称和班主任姓名
- 完善的表单验证规则

#### 2. 数据存储升级
- **从 localStorage 升级到 utools.db**
- 更安全、更可靠的数据持久化
- 支持更大的数据容量
- 支持 uTools 云同步（如果启用）

#### 3. 首次使用引导
- 首次打开应用时显示欢迎提示
- 引导用户设置班级信息
- 引导用户导入学生名单

#### 4. 空状态优化
- 班级信息为空时显示友好提示
- 学生列表为空时显示空状态和导入按钮
- 更好的用户体验

#### 5. 数据迁移工具
- 自动检测旧版本数据
- 一键迁移到新版本
- 迁移后自动清理旧数据

### 🔧 技术改进

#### 表单验证规则

**班级名称：**
- ✅ 必填项
- ✅ 长度：2-50 个字符
- ✅ 格式：只能包含中文、英文和数字
- ✅ 实时字数统计

**班主任姓名：**
- ✅ 必填项
- ✅ 长度：2-20 个字符
- ✅ 格式：只能包含中文和英文
- ✅ 实时字数统计

#### 数据库封装

```typescript
// 保存数据
dbPut(DB_KEYS.CLASS_INFO, data)

// 读取数据
dbGet<ClassInfo>(DB_KEYS.CLASS_INFO)

// 删除数据
dbRemove(DB_KEYS.CLASS_INFO)
```

#### 降级方案
- 在非 uTools 环境自动降级到 localStorage
- 保证开发和测试环境正常工作

### 🗑️ 移除内容

- ❌ 移除硬编码的班级信息（"四八班教室座位安排"、"杨玥辰"）
- ❌ 移除预设的 48 名学生数据
- ❌ 移除预设的座位安排
- ❌ 删除 `src/config/index.ts` 配置文件

## 📖 使用指南

### 首次使用

1. **设置班级信息**
   - 打开应用，看到欢迎提示
   - 点击"设置班级信息"或点击班级名称旁的编辑图标
   - 填写班级名称（如"三年级一班"）
   - 填写班主任姓名（如"张老师"）
   - 点击保存

2. **导入学生名单**
   - 点击右侧"导入Excel"按钮
   - 选择包含学生数据的 Excel 文件
   - Excel 格式要求：
     - 第一列：学号（数字）
     - 第二列：姓名（文本）
   - 确认导入
   - 选择是否立即随机排座

3. **安排座位**
   - **方法一：拖拽分配**
     - 从右侧"未就座"列表拖拽学生到座位
   - **方法二：随机排座**
     - 导入学生后选择"随机排座"
   - **调整座位：**
     - 在座位之间拖拽交换学生位置
     - 点击座位上的删除图标取消分配

4. **其他功能**
   - **搜索学生：** 在搜索框输入姓名或学号
   - **全屏排位：** 点击"全屏排位"按钮
   - **重置座位：** 点击"重置座位"清空所有座位安排

### 旧版本升级

如果你之前使用过旧版本：

1. 打开应用
2. 看到"数据迁移"提示
3. 点击"立即迁移"
4. 等待迁移完成
5. 数据已安全迁移到新版本

## 🎯 核心功能

### 1. 班级信息管理
- ✅ 自定义班级名称
- ✅ 设置班主任姓名
- ✅ 数据持久化保存

### 2. 学生管理
- ✅ Excel 批量导入
- ✅ 学生搜索（姓名/学号）
- ✅ 已就座/未就座统计
- ✅ 学生总数统计

### 3. 座位管理
- ✅ 拖拽分配座位
- ✅ 拖拽交换座位
- ✅ 随机排座
- ✅ 重置座位
- ✅ 全屏排位
- ✅ 6行8列座位布局

### 4. 数据持久化
- ✅ 自动保存所有更改
- ✅ 刷新页面数据不丢失
- ✅ 支持 uTools 云同步

## 📁 文件结构

```
src/
├── components/
│   ├── SeatTable.vue          # 主组件
│   └── EditClassDialog.vue    # 班级信息编辑对话框
├── utils/
│   ├── db.ts                  # utools.db 封装
│   └── migrate.ts             # 数据迁移工具
└── interface/
    └── index.ts               # TypeScript 类型定义
```

## 🔍 数据存储

### 存储位置
- **生产环境：** utools.db
- **开发环境：** localStorage（降级方案）

### 存储内容
| Key | 说明 | 数据结构 |
|-----|------|---------|
| `class_info` | 班级信息 | `{className: string, teacherName: string}` |
| `student_list` | 学生列表 | `Array<{id: number, name: string}>` |
| `seat_data` | 座位数据 | `Array<Seat>` |

## 🚀 开发说明

### 启动开发服务器
```bash
npm run dev
```
访问: http://localhost:5175/

### 构建生产版本
```bash
npm run build
```

### 添加新的数据存储
1. 在 `src/utils/db.ts` 中添加新的 `DB_KEY`
2. 使用 `dbPut` 和 `dbGet` 进行读写
3. 如需迁移旧数据，在 `src/utils/migrate.ts` 中添加迁移规则

## 📝 注意事项

1. **Excel 格式要求**
   - 支持 .xlsx, .xls, .csv 格式
   - 第一列必须是学号（数字）
   - 第二列必须是姓名（文本）
   - 不需要表头

2. **数据安全**
   - 所有数据自动保存
   - 建议定期导出备份
   - 重置座位不会删除学生数据

3. **性能建议**
   - 建议学生数量不超过 200 人
   - 座位布局固定为 6 行 8 列（48 个座位）

## 🐛 问题反馈

如遇到问题，请提供：
1. 操作步骤
2. 预期结果
3. 实际结果
4. 错误信息（如有）

## 📄 相关文档

- [MIGRATION.md](./MIGRATION.md) - 数据迁移详细说明
- [TEST_CHECKLIST.md](./TEST_CHECKLIST.md) - 功能测试清单
- [CLAUDE.md](./CLAUDE.md) - 项目架构说明

## ✅ 测试状态

- ✅ 构建成功
- ✅ 所有核心功能测试通过
- ✅ 数据迁移功能正常
- ✅ 表单验证正常
- ✅ 数据持久化正常

## 🎉 开始使用

开发服务器已启动: **http://localhost:5175/**

立即体验新功能！
